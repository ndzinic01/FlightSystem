<div class="notifications-page">
  <!-- Header sa statistikom -->
  <div class="page-header">
    <div class="title-section">
      <h2 class="page-title">ğŸ”” Notifikacije</h2>
      <div class="stats">
        <span class="stat-badge">
          Ukupno: <strong>{{ totalCount }}</strong>
        </span>
        <span class="stat-badge unread">
          NeproÄitano: <strong>{{ unreadCount }}</strong>
        </span>
        <span class="stat-badge system">
          Sistemske: <strong>{{ systemNotificationsCount }}</strong>
        </span>
      </div>
    </div>

    <!-- ğŸ”¥ NOVO DUGME -->
    <button class="btn-broadcast" (click)="openBroadcastDialog()">
      ğŸ“¢ PoÅ¡alji obavijest svima
    </button>
  </div>

  <!-- Filteri -->
  <div class="filters-section">
    <!-- ğŸ”¥ TIP NOTIFIKACIJE -->
    <div class="filter-group">
      <label>Vrsta notifikacije:</label>
      <select
        [(ngModel)]="notificationType"
        (change)="onNotificationTypeChange()"
        class="filter-select"
      >
        <option value="all">Sve notifikacije</option>
        <option value="user">KorisniÄki upiti</option>
        <option value="system">Sistemske obavijesti</option>
      </select>
    </div>

    <!-- Pretraga po korisniku -->
    <div class="filter-group">
      <input
        type="text"
        placeholder="PretraÅ¾i po korisniku ğŸ”"
        [(ngModel)]="userSearch"
        (input)="onUserSearch()"
        class="filter-input"
      />
    </div>

    <!-- Status filter -->
    <div class="filter-group">
      <select
        [(ngModel)]="statusSearch"
        (change)="onStatusChange()"
        class="filter-select"
      >
        <option value="all">Svi statusi</option>
        <option value="new">Novo</option>
        <option value="replied">Odgovoreno</option>
      </select>
    </div>

    <!-- Datum filter -->
    <div class="filter-group date-filter">
      <input
        type="date"
        [(ngModel)]="dateSearch"
        (change)="onDateChange($event)"
        class="filter-input"
        placeholder="PretraÅ¾i po datumu ğŸ“…"
      />
      <button
        *ngIf="dateSearch"
        class="btn-clear-date"
        (click)="clearDateFilter()"
        title="OÄisti datum"
      >
        âœ•
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <p>UÄitavanje notifikacija...</p>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && filtered.length === 0" class="empty-state">
    <p>Nema notifikacija za prikaz.</p>
  </div>

  <!-- Tabela -->
  <table class="notifications-table" *ngIf="!loading && filtered.length > 0">
    <thead>
    <tr>
      <th>Tip</th> <!-- ğŸ”¥ NOVA KOLONA -->
      <th>Korisnik</th>
      <th>Email</th>
      <th>Tema</th>
      <th>Datum</th>
      <th>Status</th>
      <th>Akcija</th>
    </tr>
    </thead>

    <tbody>
    <tr *ngFor="let n of filtered" [class.unread-row]="!n.isRead" [class.system-row]="n.isSystemGenerated">
      <!-- ğŸ”¥ TIP -->
      <td>
          <span class="type-badge" [class.type-system]="n.isSystemGenerated">
            {{ n.isSystemGenerated ? 'ğŸ¤–' : 'ğŸ‘¤' }}
          </span>
      </td>
      <td class="user-cell">{{ n.userFullName || 'Svi korisnici' }}</td>
      <td class="email-cell">{{ n.userEmail || '-' }}</td>
      <td class="message-cell">{{ n.message }}</td>
      <td>{{ formatDate(n.sentAt) }}</td>
      <td>
          <span class="status-badge" [ngClass]="statusClass(n)">
            {{ statusLabel(n) }}
          </span>
      </td>
      <td class="action-cell">
        <button class="btn-action" (click)="openDialog(n)" *ngIf="!n.isSystemGenerated">
          {{ n.isRead ? 'Pregled' : 'Odgovori' }}
        </button>
        <button class="btn-action view-only" (click)="openDialog(n)" *ngIf="n.isSystemGenerated">
          Pregled
        </button>
      </td>
    </tr>
    </tbody>
  </table>
</div>

